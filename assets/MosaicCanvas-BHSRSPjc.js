import{a as m,j as i,g as Q}from"./vendor-ui-CpM7Tz3e.js";import{u as Z}from"./index-71QTvdeu.js";import{a as le,S as de,L as ue,R as he,I as fe}from"./vendor-konva-zGhq7OT9.js";import{r as ge}from"./vendor-utils-BfOKqD4J.js";var M;(function(e){e.STRING="string",e.NUMBER="number",e.INTEGER="integer",e.BOOLEAN="boolean",e.ARRAY="array",e.OBJECT="object"})(M||(M={}));var L;(function(e){e.LANGUAGE_UNSPECIFIED="language_unspecified",e.PYTHON="python"})(L||(L={}));var D;(function(e){e.OUTCOME_UNSPECIFIED="outcome_unspecified",e.OUTCOME_OK="outcome_ok",e.OUTCOME_FAILED="outcome_failed",e.OUTCOME_DEADLINE_EXCEEDED="outcome_deadline_exceeded"})(D||(D={}));const G=["user","model","function","system"];var U;(function(e){e.HARM_CATEGORY_UNSPECIFIED="HARM_CATEGORY_UNSPECIFIED",e.HARM_CATEGORY_HATE_SPEECH="HARM_CATEGORY_HATE_SPEECH",e.HARM_CATEGORY_SEXUALLY_EXPLICIT="HARM_CATEGORY_SEXUALLY_EXPLICIT",e.HARM_CATEGORY_HARASSMENT="HARM_CATEGORY_HARASSMENT",e.HARM_CATEGORY_DANGEROUS_CONTENT="HARM_CATEGORY_DANGEROUS_CONTENT",e.HARM_CATEGORY_CIVIC_INTEGRITY="HARM_CATEGORY_CIVIC_INTEGRITY"})(U||(U={}));var $;(function(e){e.HARM_BLOCK_THRESHOLD_UNSPECIFIED="HARM_BLOCK_THRESHOLD_UNSPECIFIED",e.BLOCK_LOW_AND_ABOVE="BLOCK_LOW_AND_ABOVE",e.BLOCK_MEDIUM_AND_ABOVE="BLOCK_MEDIUM_AND_ABOVE",e.BLOCK_ONLY_HIGH="BLOCK_ONLY_HIGH",e.BLOCK_NONE="BLOCK_NONE"})($||($={}));var F;(function(e){e.HARM_PROBABILITY_UNSPECIFIED="HARM_PROBABILITY_UNSPECIFIED",e.NEGLIGIBLE="NEGLIGIBLE",e.LOW="LOW",e.MEDIUM="MEDIUM",e.HIGH="HIGH"})(F||(F={}));var H;(function(e){e.BLOCKED_REASON_UNSPECIFIED="BLOCKED_REASON_UNSPECIFIED",e.SAFETY="SAFETY",e.OTHER="OTHER"})(H||(H={}));var I;(function(e){e.FINISH_REASON_UNSPECIFIED="FINISH_REASON_UNSPECIFIED",e.STOP="STOP",e.MAX_TOKENS="MAX_TOKENS",e.SAFETY="SAFETY",e.RECITATION="RECITATION",e.LANGUAGE="LANGUAGE",e.BLOCKLIST="BLOCKLIST",e.PROHIBITED_CONTENT="PROHIBITED_CONTENT",e.SPII="SPII",e.MALFORMED_FUNCTION_CALL="MALFORMED_FUNCTION_CALL",e.OTHER="OTHER"})(I||(I={}));var P;(function(e){e.TASK_TYPE_UNSPECIFIED="TASK_TYPE_UNSPECIFIED",e.RETRIEVAL_QUERY="RETRIEVAL_QUERY",e.RETRIEVAL_DOCUMENT="RETRIEVAL_DOCUMENT",e.SEMANTIC_SIMILARITY="SEMANTIC_SIMILARITY",e.CLASSIFICATION="CLASSIFICATION",e.CLUSTERING="CLUSTERING"})(P||(P={}));var B;(function(e){e.MODE_UNSPECIFIED="MODE_UNSPECIFIED",e.AUTO="AUTO",e.ANY="ANY",e.NONE="NONE"})(B||(B={}));var K;(function(e){e.MODE_UNSPECIFIED="MODE_UNSPECIFIED",e.MODE_DYNAMIC="MODE_DYNAMIC"})(K||(K={}));class x extends Error{constructor(n){super(`[GoogleGenerativeAI Error]: ${n}`)}}class w extends x{constructor(n,t){super(n),this.response=t}}class ee extends x{constructor(n,t,s,o){super(n),this.status=t,this.statusText=s,this.errorDetails=o}}class v extends x{}class te extends x{}const pe="https://generativelanguage.googleapis.com",me="v1beta",xe="0.24.1",ye="genai-js";var C;(function(e){e.GENERATE_CONTENT="generateContent",e.STREAM_GENERATE_CONTENT="streamGenerateContent",e.COUNT_TOKENS="countTokens",e.EMBED_CONTENT="embedContent",e.BATCH_EMBED_CONTENTS="batchEmbedContents"})(C||(C={}));class Ee{constructor(n,t,s,o,a){this.model=n,this.task=t,this.apiKey=s,this.stream=o,this.requestOptions=a}toString(){var n,t;const s=((n=this.requestOptions)===null||n===void 0?void 0:n.apiVersion)||me;let a=`${((t=this.requestOptions)===null||t===void 0?void 0:t.baseUrl)||pe}/${s}/${this.model}:${this.task}`;return this.stream&&(a+="?alt=sse"),a}}function be(e){const n=[];return e?.apiClient&&n.push(e.apiClient),n.push(`${ye}/${xe}`),n.join(" ")}async function ve(e){var n;const t=new Headers;t.append("Content-Type","application/json"),t.append("x-goog-api-client",be(e.requestOptions)),t.append("x-goog-api-key",e.apiKey);let s=(n=e.requestOptions)===null||n===void 0?void 0:n.customHeaders;if(s){if(!(s instanceof Headers))try{s=new Headers(s)}catch(o){throw new v(`unable to convert customHeaders value ${JSON.stringify(s)} to Headers: ${o.message}`)}for(const[o,a]of s.entries()){if(o==="x-goog-api-key")throw new v(`Cannot set reserved header name ${o}`);if(o==="x-goog-api-client")throw new v(`Header name ${o} can only be set using the apiClient field`);t.append(o,a)}}return t}async function Ce(e,n,t,s,o,a){const r=new Ee(e,n,t,s,a);return{url:r.toString(),fetchOptions:Object.assign(Object.assign({},Ne(a)),{method:"POST",headers:await ve(r),body:o})}}async function R(e,n,t,s,o,a={},r=fetch){const{url:l,fetchOptions:d}=await Ce(e,n,t,s,o,a);return we(l,d,r)}async function we(e,n,t=fetch){let s;try{s=await t(e,n)}catch(o){_e(o,e)}return s.ok||await Ie(s,e),s}function _e(e,n){let t=e;throw t.name==="AbortError"?(t=new te(`Request aborted when fetching ${n.toString()}: ${e.message}`),t.stack=e.stack):e instanceof ee||e instanceof v||(t=new x(`Error fetching from ${n.toString()}: ${e.message}`),t.stack=e.stack),t}async function Ie(e,n){let t="",s;try{const o=await e.json();t=o.error.message,o.error.details&&(t+=` ${JSON.stringify(o.error.details)}`,s=o.error.details)}catch{}throw new ee(`Error fetching from ${n.toString()}: [${e.status} ${e.statusText}] ${t}`,e.status,e.statusText,s)}function Ne(e){const n={};if(e?.signal!==void 0||e?.timeout>=0){const t=new AbortController;e?.timeout>=0&&setTimeout(()=>t.abort(),e.timeout),e?.signal&&e.signal.addEventListener("abort",()=>{t.abort()}),n.signal=t.signal}return n}function T(e){return e.text=()=>{if(e.candidates&&e.candidates.length>0){if(e.candidates.length>1&&console.warn(`This response had ${e.candidates.length} candidates. Returning text from the first candidate only. Access response.candidates directly to use the other candidates.`),k(e.candidates[0]))throw new w(`${b(e)}`,e);return Se(e)}else if(e.promptFeedback)throw new w(`Text not available. ${b(e)}`,e);return""},e.functionCall=()=>{if(e.candidates&&e.candidates.length>0){if(e.candidates.length>1&&console.warn(`This response had ${e.candidates.length} candidates. Returning function calls from the first candidate only. Access response.candidates directly to use the other candidates.`),k(e.candidates[0]))throw new w(`${b(e)}`,e);return console.warn("response.functionCall() is deprecated. Use response.functionCalls() instead."),Y(e)[0]}else if(e.promptFeedback)throw new w(`Function call not available. ${b(e)}`,e)},e.functionCalls=()=>{if(e.candidates&&e.candidates.length>0){if(e.candidates.length>1&&console.warn(`This response had ${e.candidates.length} candidates. Returning function calls from the first candidate only. Access response.candidates directly to use the other candidates.`),k(e.candidates[0]))throw new w(`${b(e)}`,e);return Y(e)}else if(e.promptFeedback)throw new w(`Function call not available. ${b(e)}`,e)},e}function Se(e){var n,t,s,o;const a=[];if(!((t=(n=e.candidates)===null||n===void 0?void 0:n[0].content)===null||t===void 0)&&t.parts)for(const r of(o=(s=e.candidates)===null||s===void 0?void 0:s[0].content)===null||o===void 0?void 0:o.parts)r.text&&a.push(r.text),r.executableCode&&a.push("\n```"+r.executableCode.language+`
`+r.executableCode.code+"\n```\n"),r.codeExecutionResult&&a.push("\n```\n"+r.codeExecutionResult.output+"\n```\n");return a.length>0?a.join(""):""}function Y(e){var n,t,s,o;const a=[];if(!((t=(n=e.candidates)===null||n===void 0?void 0:n[0].content)===null||t===void 0)&&t.parts)for(const r of(o=(s=e.candidates)===null||s===void 0?void 0:s[0].content)===null||o===void 0?void 0:o.parts)r.functionCall&&a.push(r.functionCall);if(a.length>0)return a}const Re=[I.RECITATION,I.SAFETY,I.LANGUAGE];function k(e){return!!e.finishReason&&Re.includes(e.finishReason)}function b(e){var n,t,s;let o="";if((!e.candidates||e.candidates.length===0)&&e.promptFeedback)o+="Response was blocked",!((n=e.promptFeedback)===null||n===void 0)&&n.blockReason&&(o+=` due to ${e.promptFeedback.blockReason}`),!((t=e.promptFeedback)===null||t===void 0)&&t.blockReasonMessage&&(o+=`: ${e.promptFeedback.blockReasonMessage}`);else if(!((s=e.candidates)===null||s===void 0)&&s[0]){const a=e.candidates[0];k(a)&&(o+=`Candidate was blocked due to ${a.finishReason}`,a.finishMessage&&(o+=`: ${a.finishMessage}`))}return o}function N(e){return this instanceof N?(this.v=e,this):new N(e)}function Oe(e,n,t){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var s=t.apply(e,n||[]),o,a=[];return o={},r("next"),r("throw"),r("return"),o[Symbol.asyncIterator]=function(){return this},o;function r(u){s[u]&&(o[u]=function(c){return new Promise(function(g,y){a.push([u,c,g,y])>1||l(u,c)})})}function l(u,c){try{d(s[u](c))}catch(g){f(a[0][3],g)}}function d(u){u.value instanceof N?Promise.resolve(u.value.v).then(h,p):f(a[0][2],u)}function h(u){l("next",u)}function p(u){l("throw",u)}function f(u,c){u(c),a.shift(),a.length&&l(a[0][0],a[0][1])}}const q=/^data\: (.*)(?:\n\n|\r\r|\r\n\r\n)/;function Ae(e){const n=e.body.pipeThrough(new TextDecoderStream("utf8",{fatal:!0})),t=Te(n),[s,o]=t.tee();return{stream:je(s),response:ke(o)}}async function ke(e){const n=[],t=e.getReader();for(;;){const{done:s,value:o}=await t.read();if(s)return T(Me(n));n.push(o)}}function je(e){return Oe(this,arguments,function*(){const t=e.getReader();for(;;){const{value:s,done:o}=yield N(t.read());if(o)break;yield yield N(T(s))}})}function Te(e){const n=e.getReader();return new ReadableStream({start(s){let o="";return a();function a(){return n.read().then(({value:r,done:l})=>{if(l){if(o.trim()){s.error(new x("Failed to parse stream"));return}s.close();return}o+=r;let d=o.match(q),h;for(;d;){try{h=JSON.parse(d[1])}catch{s.error(new x(`Error parsing JSON response: "${d[1]}"`));return}s.enqueue(h),o=o.substring(d[0].length),d=o.match(q)}return a()}).catch(r=>{let l=r;throw l.stack=r.stack,l.name==="AbortError"?l=new te("Request aborted when reading from the stream"):l=new x("Error reading from the stream"),l})}}})}function Me(e){const n=e[e.length-1],t={promptFeedback:n?.promptFeedback};for(const s of e){if(s.candidates){let o=0;for(const a of s.candidates)if(t.candidates||(t.candidates=[]),t.candidates[o]||(t.candidates[o]={index:o}),t.candidates[o].citationMetadata=a.citationMetadata,t.candidates[o].groundingMetadata=a.groundingMetadata,t.candidates[o].finishReason=a.finishReason,t.candidates[o].finishMessage=a.finishMessage,t.candidates[o].safetyRatings=a.safetyRatings,a.content&&a.content.parts){t.candidates[o].content||(t.candidates[o].content={role:a.content.role||"user",parts:[]});const r={};for(const l of a.content.parts)l.text&&(r.text=l.text),l.functionCall&&(r.functionCall=l.functionCall),l.executableCode&&(r.executableCode=l.executableCode),l.codeExecutionResult&&(r.codeExecutionResult=l.codeExecutionResult),Object.keys(r).length===0&&(r.text=""),t.candidates[o].content.parts.push(r)}o++}s.usageMetadata&&(t.usageMetadata=s.usageMetadata)}return t}async function ne(e,n,t,s){const o=await R(n,C.STREAM_GENERATE_CONTENT,e,!0,JSON.stringify(t),s);return Ae(o)}async function se(e,n,t,s){const a=await(await R(n,C.GENERATE_CONTENT,e,!1,JSON.stringify(t),s)).json();return{response:T(a)}}function oe(e){if(e!=null){if(typeof e=="string")return{role:"system",parts:[{text:e}]};if(e.text)return{role:"system",parts:[e]};if(e.parts)return e.role?e:{role:"system",parts:e.parts}}}function S(e){let n=[];if(typeof e=="string")n=[{text:e}];else for(const t of e)typeof t=="string"?n.push({text:t}):n.push(t);return Le(n)}function Le(e){const n={role:"user",parts:[]},t={role:"function",parts:[]};let s=!1,o=!1;for(const a of e)"functionResponse"in a?(t.parts.push(a),o=!0):(n.parts.push(a),s=!0);if(s&&o)throw new x("Within a single message, FunctionResponse cannot be mixed with other type of part in the request for sending chat message.");if(!s&&!o)throw new x("No content is provided for sending chat message.");return s?n:t}function De(e,n){var t;let s={model:n?.model,generationConfig:n?.generationConfig,safetySettings:n?.safetySettings,tools:n?.tools,toolConfig:n?.toolConfig,systemInstruction:n?.systemInstruction,cachedContent:(t=n?.cachedContent)===null||t===void 0?void 0:t.name,contents:[]};const o=e.generateContentRequest!=null;if(e.contents){if(o)throw new v("CountTokensRequest must have one of contents or generateContentRequest, not both.");s.contents=e.contents}else if(o)s=Object.assign(Object.assign({},s),e.generateContentRequest);else{const a=S(e);s.contents=[a]}return{generateContentRequest:s}}function V(e){let n;return e.contents?n=e:n={contents:[S(e)]},e.systemInstruction&&(n.systemInstruction=oe(e.systemInstruction)),n}function Ge(e){return typeof e=="string"||Array.isArray(e)?{content:S(e)}:e}const W=["text","inlineData","functionCall","functionResponse","executableCode","codeExecutionResult"],Ue={user:["text","inlineData"],function:["functionResponse"],model:["text","functionCall","executableCode","codeExecutionResult"],system:["text"]};function $e(e){let n=!1;for(const t of e){const{role:s,parts:o}=t;if(!n&&s!=="user")throw new x(`First content should be with role 'user', got ${s}`);if(!G.includes(s))throw new x(`Each item should include role field. Got ${s} but valid roles are: ${JSON.stringify(G)}`);if(!Array.isArray(o))throw new x("Content should have 'parts' property with an array of Parts");if(o.length===0)throw new x("Each Content should have at least one part");const a={text:0,inlineData:0,functionCall:0,functionResponse:0,fileData:0,executableCode:0,codeExecutionResult:0};for(const l of o)for(const d of W)d in l&&(a[d]+=1);const r=Ue[s];for(const l of W)if(!r.includes(l)&&a[l]>0)throw new x(`Content with role '${s}' can't contain '${l}' part`);n=!0}}function J(e){var n;if(e.candidates===void 0||e.candidates.length===0)return!1;const t=(n=e.candidates[0])===null||n===void 0?void 0:n.content;if(t===void 0||t.parts===void 0||t.parts.length===0)return!1;for(const s of t.parts)if(s===void 0||Object.keys(s).length===0||s.text!==void 0&&s.text==="")return!1;return!0}const z="SILENT_ERROR";class Fe{constructor(n,t,s,o={}){this.model=t,this.params=s,this._requestOptions=o,this._history=[],this._sendPromise=Promise.resolve(),this._apiKey=n,s?.history&&($e(s.history),this._history=s.history)}async getHistory(){return await this._sendPromise,this._history}async sendMessage(n,t={}){var s,o,a,r,l,d;await this._sendPromise;const h=S(n),p={safetySettings:(s=this.params)===null||s===void 0?void 0:s.safetySettings,generationConfig:(o=this.params)===null||o===void 0?void 0:o.generationConfig,tools:(a=this.params)===null||a===void 0?void 0:a.tools,toolConfig:(r=this.params)===null||r===void 0?void 0:r.toolConfig,systemInstruction:(l=this.params)===null||l===void 0?void 0:l.systemInstruction,cachedContent:(d=this.params)===null||d===void 0?void 0:d.cachedContent,contents:[...this._history,h]},f=Object.assign(Object.assign({},this._requestOptions),t);let u;return this._sendPromise=this._sendPromise.then(()=>se(this._apiKey,this.model,p,f)).then(c=>{var g;if(J(c.response)){this._history.push(h);const y=Object.assign({parts:[],role:"model"},(g=c.response.candidates)===null||g===void 0?void 0:g[0].content);this._history.push(y)}else{const y=b(c.response);y&&console.warn(`sendMessage() was unsuccessful. ${y}. Inspect response object for details.`)}u=c}).catch(c=>{throw this._sendPromise=Promise.resolve(),c}),await this._sendPromise,u}async sendMessageStream(n,t={}){var s,o,a,r,l,d;await this._sendPromise;const h=S(n),p={safetySettings:(s=this.params)===null||s===void 0?void 0:s.safetySettings,generationConfig:(o=this.params)===null||o===void 0?void 0:o.generationConfig,tools:(a=this.params)===null||a===void 0?void 0:a.tools,toolConfig:(r=this.params)===null||r===void 0?void 0:r.toolConfig,systemInstruction:(l=this.params)===null||l===void 0?void 0:l.systemInstruction,cachedContent:(d=this.params)===null||d===void 0?void 0:d.cachedContent,contents:[...this._history,h]},f=Object.assign(Object.assign({},this._requestOptions),t),u=ne(this._apiKey,this.model,p,f);return this._sendPromise=this._sendPromise.then(()=>u).catch(c=>{throw new Error(z)}).then(c=>c.response).then(c=>{if(J(c)){this._history.push(h);const g=Object.assign({},c.candidates[0].content);g.role||(g.role="model"),this._history.push(g)}else{const g=b(c);g&&console.warn(`sendMessageStream() was unsuccessful. ${g}. Inspect response object for details.`)}}).catch(c=>{c.message!==z&&console.error(c)}),u}}async function He(e,n,t,s){return(await R(n,C.COUNT_TOKENS,e,!1,JSON.stringify(t),s)).json()}async function Pe(e,n,t,s){return(await R(n,C.EMBED_CONTENT,e,!1,JSON.stringify(t),s)).json()}async function Be(e,n,t,s){const o=t.requests.map(r=>Object.assign(Object.assign({},r),{model:n}));return(await R(n,C.BATCH_EMBED_CONTENTS,e,!1,JSON.stringify({requests:o}),s)).json()}class X{constructor(n,t,s={}){this.apiKey=n,this._requestOptions=s,t.model.includes("/")?this.model=t.model:this.model=`models/${t.model}`,this.generationConfig=t.generationConfig||{},this.safetySettings=t.safetySettings||[],this.tools=t.tools,this.toolConfig=t.toolConfig,this.systemInstruction=oe(t.systemInstruction),this.cachedContent=t.cachedContent}async generateContent(n,t={}){var s;const o=V(n),a=Object.assign(Object.assign({},this._requestOptions),t);return se(this.apiKey,this.model,Object.assign({generationConfig:this.generationConfig,safetySettings:this.safetySettings,tools:this.tools,toolConfig:this.toolConfig,systemInstruction:this.systemInstruction,cachedContent:(s=this.cachedContent)===null||s===void 0?void 0:s.name},o),a)}async generateContentStream(n,t={}){var s;const o=V(n),a=Object.assign(Object.assign({},this._requestOptions),t);return ne(this.apiKey,this.model,Object.assign({generationConfig:this.generationConfig,safetySettings:this.safetySettings,tools:this.tools,toolConfig:this.toolConfig,systemInstruction:this.systemInstruction,cachedContent:(s=this.cachedContent)===null||s===void 0?void 0:s.name},o),a)}startChat(n){var t;return new Fe(this.apiKey,this.model,Object.assign({generationConfig:this.generationConfig,safetySettings:this.safetySettings,tools:this.tools,toolConfig:this.toolConfig,systemInstruction:this.systemInstruction,cachedContent:(t=this.cachedContent)===null||t===void 0?void 0:t.name},n),this._requestOptions)}async countTokens(n,t={}){const s=De(n,{model:this.model,generationConfig:this.generationConfig,safetySettings:this.safetySettings,tools:this.tools,toolConfig:this.toolConfig,systemInstruction:this.systemInstruction,cachedContent:this.cachedContent}),o=Object.assign(Object.assign({},this._requestOptions),t);return He(this.apiKey,this.model,s,o)}async embedContent(n,t={}){const s=Ge(n),o=Object.assign(Object.assign({},this._requestOptions),t);return Pe(this.apiKey,this.model,s,o)}async batchEmbedContents(n,t={}){const s=Object.assign(Object.assign({},this._requestOptions),t);return Be(this.apiKey,this.model,n,s)}}class Ke{constructor(n){this.apiKey=n}getGenerativeModel(n,t){if(!n.model)throw new x("Must provide a model name. Example: genai.getGenerativeModel({ model: 'my-model-name' })");return new X(this.apiKey,n,t)}getGenerativeModelFromCachedContent(n,t,s){if(!n.name)throw new v("Cached content must contain a `name` field.");if(!n.model)throw new v("Cached content must contain a `model` field.");const o=["model","systemInstruction"];for(const r of o)if(t?.[r]&&n[r]&&t?.[r]!==n[r]){if(r==="model"){const l=t.model.startsWith("models/")?t.model.replace("models/",""):t.model,d=n.model.startsWith("models/")?n.model.replace("models/",""):n.model;if(l===d)continue}throw new v(`Different value for "${r}" specified in modelParams (${t[r]}) and cachedContent (${n[r]})`)}const a=Object.assign(Object.assign({},t),{model:n.model,tools:n.tools,toolConfig:n.toolConfig,systemInstruction:n.systemInstruction,cachedContent:n});return new X(this.apiKey,a,s)}}const Ye="gemini-1.5-flash",qe=[{id:"vintage",name:"Vintage Print",description:"Adds grain, faded colors, and paper texture.",prompt:"Transform this music album mosaic into a vintage 1970s print. Add realistic paper texture, slight color fading, and film grain. Maintain the layout but make it look like a physical relic.",textInstructions:"Render the title in a weathered, distressed serif typeface (like Cooper Black or Windsor). The text should look like it was printed with ink that has slightly bled into the paper. Place it at the top or bottom in a classic album title layout."},{id:"neon",name:"Cyberpunk Glow",description:"Neon highlights and high-contrast darks.",prompt:"Enhance this mosaic with a cyberpunk aesthetic. Add neon blue and pink glows to the edges of the album covers. Increase contrast and add a subtle digital scanline effect.",textInstructions:"Render the title in a sharp, futuristic sans-serif font with a vibrant neon pink or electric blue outer glow. Add a slight glitch or chromatic aberration effect to the text."},{id:"polaroid",name:"Polaroid Grid",description:"Makes each cover look like a separate polaroid.",prompt:"Process this image so each album cover appears to be an individual Polaroid photo with white borders, slightly rotated for a messy, organic feel on a dark tabletop.",textInstructions:"Write the title at the bottom of the image in a casual, black permanent marker handwriting style, as if written on the bottom of a photo frame."}],Ve={enhanceMosaic:async(e,n,t)=>{const s=Z.getState().apiKeys.gemini||void 0,o=!s||s.startsWith("your_");let a=n.prompt;if(t&&(a+=` Add the text "${t}" to the image. ${n.textInstructions} Ensure the text is clearly legible but integrated into the style.`),o)return console.log("AI Service: Running in MOCK mode with prompt:",a),await new Promise(p=>setTimeout(p,2e3)),e;const l=new Ke(s).getGenerativeModel({model:Ye}),d=e.split(",")[1];return await(await l.generateContent([a,{inlineData:{data:d,mimeType:"image/png"}}])).response,e}},We=({onGetImageSource:e,onEnhanced:n})=>{const[t,s]=m.useState(!1),[o,a]=m.useState(null),[r,l]=m.useState(""),[d,h]=m.useState(null),{apiKeys:p}=Z(),f=p.gemini&&p.gemini.length>0||void 0,u=async()=>{if(o){s(!0),h(null);try{const c=e(),g=await Ve.enhanceMosaic(c,o,r);n(g)}catch(c){h("AI Enhancement failed. Check your API key or connection."),console.error(c)}finally{s(!1)}}};return i.jsxs("div",{className:"w-full lg:w-80 space-y-6 bg-white dark:bg-gray-900 p-8 rounded-2xl border border-gray-100 dark:border-gray-800 h-fit shadow-sm mt-8 lg:mt-0",children:[i.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[i.jsx("div",{className:"bg-purple-500 p-1.5 rounded-lg text-white",children:i.jsx("svg",{width:"16",height:"16",fill:"currentColor",viewBox:"0 0 24 24",children:i.jsx("path",{d:"M12 2L14.5 9.5L22 12L14.5 14.5L12 22L9.5 14.5L2 12L9.5 9.5L12 2Z"})})}),i.jsx("h3",{className:"text-xl font-black",children:"AI Lab"})]}),i.jsxs("div",{className:"space-y-4",children:[i.jsxs("div",{className:"space-y-2",children:[i.jsx("label",{className:"text-[10px] font-black text-gray-400 dark:text-gray-500 uppercase tracking-widest",children:"Mix Tape Title"}),i.jsx("input",{type:"text",value:r,onChange:c=>l(c.target.value),placeholder:"e.g. Sofa Syndicate Vol. 1",className:"w-full p-3 rounded-xl bg-gray-50 dark:bg-gray-800 border border-gray-100 dark:border-gray-700 text-sm focus:outline-none focus:ring-2 focus:ring-purple-500 transition-all"})]}),i.jsxs("div",{className:"space-y-2",children:[i.jsx("label",{className:"text-[10px] font-black text-gray-400 dark:text-gray-500 uppercase tracking-widest",children:"Select Style"}),i.jsx("div",{className:"space-y-2",children:qe.map(c=>i.jsxs("button",{onClick:()=>a(c),className:`w-full p-4 rounded-xl border text-left transition-all ${o?.id===c.id?"border-purple-500 bg-purple-50 dark:bg-purple-500/10":"border-gray-100 dark:border-gray-800 hover:border-gray-200 dark:hover:border-gray-700"}`,children:[i.jsx("p",{className:`text-sm font-bold ${o?.id===c.id?"text-purple-600 dark:text-purple-400":""}`,children:c.name}),i.jsx("p",{className:"text-[10px] text-gray-500 dark:text-gray-400 mt-1",children:c.description})]},c.id))})]})]}),d&&i.jsx("p",{className:"text-[10px] text-red-500 font-bold bg-red-50 dark:bg-red-500/10 p-2 rounded-lg border border-red-200 dark:border-red-900/50",children:d}),i.jsx("button",{onClick:u,disabled:!o||t||!f,title:f?"":"Gemini API Key required. Configure in Settings.",className:`w-full py-4 font-black rounded-xl transition-all flex items-center justify-center gap-3 shadow-lg active:scale-[0.98] ${!o||t||!f?"bg-gray-100 dark:bg-gray-800 text-gray-400 cursor-not-allowed":"bg-gradient-to-r from-purple-600 to-blue-600 text-white hover:from-purple-700 hover:to-blue-700 shadow-purple-500/20"}`,children:t?i.jsxs(i.Fragment,{children:[i.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-2 border-white/30 border-t-white"}),"PROCESSING..."]}):i.jsxs(i.Fragment,{children:[i.jsx("svg",{width:"18",height:"18",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:i.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M13 10V3L4 14h7v7l9-11h-7z"})}),"ENHANCE & ADD TITLE"]})}),!f&&i.jsx("p",{className:"text-[10px] text-center text-red-500 font-bold",children:"API Key Missing"}),i.jsx("p",{className:"text-[9px] text-center text-gray-400 dark:text-gray-600 uppercase font-black tracking-widest",children:"Powered by Gemini Nano Banana"})]})};var Je=ge();const A=Q(Je),ze=({stageRef:e,albums:n})=>{const[t,s]=m.useState("png"),[o]=m.useState(.9),a=m.useCallback(()=>e.current?e.current.toDataURL({pixelRatio:2}):"",[e]),r=m.useCallback(()=>{if(!e.current)return;const l=e.current.toDataURL({pixelRatio:3,mimeType:`image/${t}`,quality:t==="jpeg"?o:void 0});let d=l;if(t==="jpeg")try{const p=n.map(E=>`${E.artist} - ${E.album}`).join(", "),f={},u={},c={};f[A.ImageIFD.Software]="WhiteLabel Album Art Creator",u[A.ExifIFD.UserComment]=p;const g={"0th":f,Exif:u,GPS:c},y=A.dump(g);d=A.insert(y,l)}catch(p){console.error("Failed to inject metadata:",p)}const h=document.createElement("a");h.download=`whitelabel-${Date.now()}.${t}`,h.href=d,document.body.appendChild(h),h.click(),document.body.removeChild(h)},[e,t,o,n]);return{format:t,setFormat:s,handleExport:r,getCanvasBase64:a}},Xe=({bgColor:e,setBgColor:n,columns:t,setColumns:s,gap:o,setGap:a,padding:r,setPadding:l,format:d,setFormat:h,onExport:p,disabled:f})=>{const u=["#0a0a0a","#ffffff","#1f2937","#dc2626","#ea580c","#d97706","#16a34a","#2563eb","#7c3aed","#db2777"];return i.jsxs("div",{className:"bg-white dark:bg-gray-900 p-6 rounded-2xl border border-gray-100 dark:border-gray-800 shadow-sm",children:[i.jsx("h3",{className:"text-xl font-black border-b border-gray-100 dark:border-gray-800 pb-4 mb-6",children:"Canvas Settings"}),i.jsxs("div",{className:"space-y-6",children:[i.jsxs("div",{className:"space-y-2",children:[i.jsxs("label",{className:"text-[10px] font-black text-gray-400 dark:text-gray-500 uppercase tracking-widest flex justify-between",children:["Background",i.jsx("span",{className:"text-gray-900 dark:text-white uppercase",children:e})]}),i.jsxs("div",{className:"grid grid-cols-5 gap-2",children:[u.map(c=>i.jsx("button",{onClick:()=>n(c),disabled:f,className:`w-full aspect-square rounded-lg border transition-all ${e===c?"border-blue-500 scale-110 shadow-md ring-2 ring-blue-500/20":"border-transparent hover:scale-105"}`,style:{backgroundColor:c}},c)),i.jsxs("div",{className:"relative col-span-5 mt-2",children:[i.jsx("input",{type:"color",value:e,onChange:c=>n(c.target.value),className:"w-full h-8 cursor-pointer rounded-lg overflow-hidden opacity-0 absolute inset-0 z-10",disabled:f}),i.jsx("div",{className:"w-full h-8 rounded-lg border border-gray-200 dark:border-gray-700 flex items-center justify-center text-xs font-bold text-gray-500 hover:bg-gray-50 dark:hover:bg-gray-800 transition-colors",children:"Custom Color Picker"})]})]})]}),i.jsxs("div",{className:"space-y-2",children:[i.jsxs("label",{className:"text-[10px] font-black text-gray-400 dark:text-gray-500 uppercase tracking-widest flex justify-between",children:["Columns",i.jsx("span",{className:"text-gray-900 dark:text-white",children:t})]}),i.jsx("input",{type:"range",min:"1",max:"10",value:t,disabled:f,onChange:c=>s(parseInt(c.target.value)),className:"w-full h-1.5 bg-gray-100 dark:bg-gray-800 rounded-lg appearance-none cursor-pointer accent-blue-500 disabled:opacity-50"})]}),i.jsxs("div",{className:"space-y-2",children:[i.jsxs("label",{className:"text-[10px] font-black text-gray-400 dark:text-gray-500 uppercase tracking-widest flex justify-between",children:["Gap",i.jsxs("span",{className:"text-gray-900 dark:text-white",children:[o,"px"]})]}),i.jsx("input",{type:"range",min:"0",max:"50",value:o,disabled:f,onChange:c=>a(parseInt(c.target.value)),className:"w-full h-1.5 bg-gray-100 dark:bg-gray-800 rounded-lg appearance-none cursor-pointer accent-blue-500 disabled:opacity-50"})]}),i.jsxs("div",{className:"space-y-2",children:[i.jsxs("label",{className:"text-[10px] font-black text-gray-400 dark:text-gray-500 uppercase tracking-widest flex justify-between",children:["Padding",i.jsxs("span",{className:"text-gray-900 dark:text-white",children:[r,"px"]})]}),i.jsx("input",{type:"range",min:"0",max:"100",value:r,disabled:f,onChange:c=>l(parseInt(c.target.value)),className:"w-full h-1.5 bg-gray-100 dark:bg-gray-800 rounded-lg appearance-none cursor-pointer accent-blue-500 disabled:opacity-50"})]})]}),i.jsxs("div",{className:"space-y-4 pt-6 mt-6 border-t border-gray-100 dark:border-gray-800",children:[i.jsx("h4",{className:"text-[10px] font-black text-gray-400 dark:text-gray-500 uppercase tracking-widest",children:"Export Settings"}),i.jsxs("div",{className:"flex bg-gray-100 dark:bg-gray-800 p-1 rounded-xl",children:[i.jsx("button",{onClick:()=>h("png"),className:`flex-1 py-2 text-xs font-black rounded-lg transition-all ${d==="png"?"bg-white dark:bg-gray-700 text-gray-900 dark:text-white shadow-sm":"text-gray-400 hover:text-gray-600 dark:hover:text-gray-300"}`,children:"PNG"}),i.jsx("button",{onClick:()=>h("jpeg"),className:`flex-1 py-2 text-xs font-black rounded-lg transition-all ${d==="jpeg"?"bg-white dark:bg-gray-700 text-gray-900 dark:text-white shadow-sm":"text-gray-400 hover:text-gray-600 dark:hover:text-gray-300"}`,children:"JPEG"})]}),i.jsxs("button",{onClick:p,className:"w-full py-4 bg-gray-900 dark:bg-white text-white dark:text-black font-black rounded-xl hover:bg-black dark:hover:bg-gray-100 transition-all flex items-center justify-center gap-3 shadow-lg active:scale-[0.98] mt-4",children:[i.jsx("svg",{width:"20",height:"20",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:i.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"})}),"DOWNLOAD"]})]})]})};var Qe=le();const Ze=Q(Qe),et=({album:e,x:n,y:t,size:s})=>{const[o]=Ze(e.localUrl||e.url,"anonymous");return i.jsx(fe,{image:o,x:n,y:t,width:s,height:s,cornerRadius:2})},tt=({stageRef:e,albums:n,columns:t,gap:s,padding:o,bgColor:a,stageSize:r,isHidden:l})=>{const d=Math.ceil(n.length/t),h=r,f=(h-o*2-s*(t-1))/t,u=d*f+s*(d-1)+o*2;return i.jsx(de,{width:h,height:u,ref:e,className:`rounded-lg overflow-hidden shadow-inner ${l?"hidden":"block"}`,children:i.jsxs(ue,{children:[i.jsx(he,{x:0,y:0,width:h,height:u,fill:a}),n.map((c,g)=>{const y=g%t,E=Math.floor(g/t),O=o+y*(f+s),j=o+E*(f+s);return i.jsx(et,{album:c,x:O,y:j,size:f},c.id)})]})})},it=({albums:e,columns:n=3,gap:t=2,padding:s=6,backgroundColor:o="#0a0a0a"})=>{const a=m.useRef(null),[r,l]=m.useState(800),[d,h]=m.useState(n),[p,f]=m.useState(t),[u,c]=m.useState(s),[g,y]=m.useState(o),[E,O]=m.useState(null),{format:j,setFormat:ae,handleExport:ie,getCanvasBase64:re}=ze({stageRef:a,albums:e});return m.useEffect(()=>{const _=()=>{const ce=Math.min(window.innerWidth-40,800);l(ce)};return window.addEventListener("resize",_),_(),()=>window.removeEventListener("resize",_)},[]),i.jsxs("div",{className:"flex flex-col lg:flex-row gap-8 w-full max-w-7xl items-start",children:[i.jsxs("div",{className:"flex-1 flex flex-col items-center gap-6 w-full",children:[i.jsxs("div",{className:"bg-white dark:bg-gray-900 p-4 rounded-2xl shadow-xl border border-gray-100 dark:border-gray-800 w-full overflow-hidden flex justify-center relative",children:[i.jsx(tt,{stageRef:a,albums:e,columns:d,gap:p,padding:u,bgColor:g,stageSize:r,isHidden:!!E}),E&&i.jsxs("div",{className:"relative group animate-in zoom-in-95 duration-500",children:[i.jsx("img",{src:E,alt:"AI Enhanced",className:"rounded-lg shadow-2xl max-w-full"}),i.jsx("button",{onClick:()=>O(null),className:"absolute top-4 right-4 bg-black/50 hover:bg-black text-white px-3 py-1 rounded-full text-xs font-bold backdrop-blur-md transition-all opacity-0 group-hover:opacity-100",children:"Reset AI"})]})]}),E&&i.jsxs("div",{className:"bg-purple-500/10 border border-purple-500/20 text-purple-600 dark:text-purple-400 p-4 rounded-xl text-center w-full",children:[i.jsx("p",{className:"text-sm font-bold",children:"âœ¨ AI Enhancement Applied"}),i.jsx("p",{className:"text-xs",children:"Your image has been reimagined by Nano Banana. You can still adjust export settings below."})]})]}),i.jsxs("div",{className:"w-full lg:w-80 flex flex-col gap-6",children:[i.jsx(Xe,{bgColor:g,setBgColor:y,columns:d,setColumns:h,gap:p,setGap:f,padding:u,setPadding:c,format:j,setFormat:ae,onExport:ie,disabled:!!E}),!E&&i.jsx(We,{onGetImageSource:re,onEnhanced:_=>O(_)})]})]})};export{it as MosaicCanvas};
