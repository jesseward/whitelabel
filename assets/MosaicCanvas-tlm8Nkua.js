import{a as b,j as i,g as Z}from"./vendor-ui-CpM7Tz3e.js";import{u as ee}from"./index-Ql_V9AiN.js";import{a as ue,S as he,L as ge,R as fe,I as pe}from"./vendor-konva-zGhq7OT9.js";import{r as me}from"./vendor-utils-BfOKqD4J.js";var L;(function(e){e.STRING="string",e.NUMBER="number",e.INTEGER="integer",e.BOOLEAN="boolean",e.ARRAY="array",e.OBJECT="object"})(L||(L={}));var D;(function(e){e.LANGUAGE_UNSPECIFIED="language_unspecified",e.PYTHON="python"})(D||(D={}));var G;(function(e){e.OUTCOME_UNSPECIFIED="outcome_unspecified",e.OUTCOME_OK="outcome_ok",e.OUTCOME_FAILED="outcome_failed",e.OUTCOME_DEADLINE_EXCEEDED="outcome_deadline_exceeded"})(G||(G={}));const $=["user","model","function","system"];var U;(function(e){e.HARM_CATEGORY_UNSPECIFIED="HARM_CATEGORY_UNSPECIFIED",e.HARM_CATEGORY_HATE_SPEECH="HARM_CATEGORY_HATE_SPEECH",e.HARM_CATEGORY_SEXUALLY_EXPLICIT="HARM_CATEGORY_SEXUALLY_EXPLICIT",e.HARM_CATEGORY_HARASSMENT="HARM_CATEGORY_HARASSMENT",e.HARM_CATEGORY_DANGEROUS_CONTENT="HARM_CATEGORY_DANGEROUS_CONTENT",e.HARM_CATEGORY_CIVIC_INTEGRITY="HARM_CATEGORY_CIVIC_INTEGRITY"})(U||(U={}));var H;(function(e){e.HARM_BLOCK_THRESHOLD_UNSPECIFIED="HARM_BLOCK_THRESHOLD_UNSPECIFIED",e.BLOCK_LOW_AND_ABOVE="BLOCK_LOW_AND_ABOVE",e.BLOCK_MEDIUM_AND_ABOVE="BLOCK_MEDIUM_AND_ABOVE",e.BLOCK_ONLY_HIGH="BLOCK_ONLY_HIGH",e.BLOCK_NONE="BLOCK_NONE"})(H||(H={}));var F;(function(e){e.HARM_PROBABILITY_UNSPECIFIED="HARM_PROBABILITY_UNSPECIFIED",e.NEGLIGIBLE="NEGLIGIBLE",e.LOW="LOW",e.MEDIUM="MEDIUM",e.HIGH="HIGH"})(F||(F={}));var P;(function(e){e.BLOCKED_REASON_UNSPECIFIED="BLOCKED_REASON_UNSPECIFIED",e.SAFETY="SAFETY",e.OTHER="OTHER"})(P||(P={}));var _;(function(e){e.FINISH_REASON_UNSPECIFIED="FINISH_REASON_UNSPECIFIED",e.STOP="STOP",e.MAX_TOKENS="MAX_TOKENS",e.SAFETY="SAFETY",e.RECITATION="RECITATION",e.LANGUAGE="LANGUAGE",e.BLOCKLIST="BLOCKLIST",e.PROHIBITED_CONTENT="PROHIBITED_CONTENT",e.SPII="SPII",e.MALFORMED_FUNCTION_CALL="MALFORMED_FUNCTION_CALL",e.OTHER="OTHER"})(_||(_={}));var B;(function(e){e.TASK_TYPE_UNSPECIFIED="TASK_TYPE_UNSPECIFIED",e.RETRIEVAL_QUERY="RETRIEVAL_QUERY",e.RETRIEVAL_DOCUMENT="RETRIEVAL_DOCUMENT",e.SEMANTIC_SIMILARITY="SEMANTIC_SIMILARITY",e.CLASSIFICATION="CLASSIFICATION",e.CLUSTERING="CLUSTERING"})(B||(B={}));var K;(function(e){e.MODE_UNSPECIFIED="MODE_UNSPECIFIED",e.AUTO="AUTO",e.ANY="ANY",e.NONE="NONE"})(K||(K={}));var Y;(function(e){e.MODE_UNSPECIFIED="MODE_UNSPECIFIED",e.MODE_DYNAMIC="MODE_DYNAMIC"})(Y||(Y={}));class v extends Error{constructor(n){super(`[GoogleGenerativeAI Error]: ${n}`)}}class k extends v{constructor(n,t){super(n),this.response=t}}class te extends v{constructor(n,t,s,a){super(n),this.status=t,this.statusText=s,this.errorDetails=a}}class w extends v{}class ne extends v{}const xe="https://generativelanguage.googleapis.com",be="v1beta",ye="0.24.1",ve="genai-js";var N;(function(e){e.GENERATE_CONTENT="generateContent",e.STREAM_GENERATE_CONTENT="streamGenerateContent",e.COUNT_TOKENS="countTokens",e.EMBED_CONTENT="embedContent",e.BATCH_EMBED_CONTENTS="batchEmbedContents"})(N||(N={}));class Ee{constructor(n,t,s,a,o){this.model=n,this.task=t,this.apiKey=s,this.stream=a,this.requestOptions=o}toString(){var n,t;const s=((n=this.requestOptions)===null||n===void 0?void 0:n.apiVersion)||be;let o=`${((t=this.requestOptions)===null||t===void 0?void 0:t.baseUrl)||xe}/${s}/${this.model}:${this.task}`;return this.stream&&(o+="?alt=sse"),o}}function Ce(e){const n=[];return e?.apiClient&&n.push(e.apiClient),n.push(`${ve}/${ye}`),n.join(" ")}async function we(e){var n;const t=new Headers;t.append("Content-Type","application/json"),t.append("x-goog-api-client",Ce(e.requestOptions)),t.append("x-goog-api-key",e.apiKey);let s=(n=e.requestOptions)===null||n===void 0?void 0:n.customHeaders;if(s){if(!(s instanceof Headers))try{s=new Headers(s)}catch(a){throw new w(`unable to convert customHeaders value ${JSON.stringify(s)} to Headers: ${a.message}`)}for(const[a,o]of s.entries()){if(a==="x-goog-api-key")throw new w(`Cannot set reserved header name ${a}`);if(a==="x-goog-api-client")throw new w(`Header name ${a} can only be set using the apiClient field`);t.append(a,o)}}return t}async function Ne(e,n,t,s,a,o){const r=new Ee(e,n,t,s,o);return{url:r.toString(),fetchOptions:Object.assign(Object.assign({},Se(o)),{method:"POST",headers:await we(r),body:a})}}async function R(e,n,t,s,a,o={},r=fetch){const{url:c,fetchOptions:d}=await Ne(e,n,t,s,a,o);return ke(c,d,r)}async function ke(e,n,t=fetch){let s;try{s=await t(e,n)}catch(a){Ie(a,e)}return s.ok||await _e(s,e),s}function Ie(e,n){let t=e;throw t.name==="AbortError"?(t=new ne(`Request aborted when fetching ${n.toString()}: ${e.message}`),t.stack=e.stack):e instanceof te||e instanceof w||(t=new v(`Error fetching from ${n.toString()}: ${e.message}`),t.stack=e.stack),t}async function _e(e,n){let t="",s;try{const a=await e.json();t=a.error.message,a.error.details&&(t+=` ${JSON.stringify(a.error.details)}`,s=a.error.details)}catch{}throw new te(`Error fetching from ${n.toString()}: [${e.status} ${e.statusText}] ${t}`,e.status,e.statusText,s)}function Se(e){const n={};if(e?.signal!==void 0||e?.timeout>=0){const t=new AbortController;e?.timeout>=0&&setTimeout(()=>t.abort(),e.timeout),e?.signal&&e.signal.addEventListener("abort",()=>{t.abort()}),n.signal=t.signal}return n}function T(e){return e.text=()=>{if(e.candidates&&e.candidates.length>0){if(e.candidates.length>1&&console.warn(`This response had ${e.candidates.length} candidates. Returning text from the first candidate only. Access response.candidates directly to use the other candidates.`),j(e.candidates[0]))throw new k(`${C(e)}`,e);return Oe(e)}else if(e.promptFeedback)throw new k(`Text not available. ${C(e)}`,e);return""},e.functionCall=()=>{if(e.candidates&&e.candidates.length>0){if(e.candidates.length>1&&console.warn(`This response had ${e.candidates.length} candidates. Returning function calls from the first candidate only. Access response.candidates directly to use the other candidates.`),j(e.candidates[0]))throw new k(`${C(e)}`,e);return console.warn("response.functionCall() is deprecated. Use response.functionCalls() instead."),q(e)[0]}else if(e.promptFeedback)throw new k(`Function call not available. ${C(e)}`,e)},e.functionCalls=()=>{if(e.candidates&&e.candidates.length>0){if(e.candidates.length>1&&console.warn(`This response had ${e.candidates.length} candidates. Returning function calls from the first candidate only. Access response.candidates directly to use the other candidates.`),j(e.candidates[0]))throw new k(`${C(e)}`,e);return q(e)}else if(e.promptFeedback)throw new k(`Function call not available. ${C(e)}`,e)},e}function Oe(e){var n,t,s,a;const o=[];if(!((t=(n=e.candidates)===null||n===void 0?void 0:n[0].content)===null||t===void 0)&&t.parts)for(const r of(a=(s=e.candidates)===null||s===void 0?void 0:s[0].content)===null||a===void 0?void 0:a.parts)r.text&&o.push(r.text),r.executableCode&&o.push("\n```"+r.executableCode.language+`
`+r.executableCode.code+"\n```\n"),r.codeExecutionResult&&o.push("\n```\n"+r.codeExecutionResult.output+"\n```\n");return o.length>0?o.join(""):""}function q(e){var n,t,s,a;const o=[];if(!((t=(n=e.candidates)===null||n===void 0?void 0:n[0].content)===null||t===void 0)&&t.parts)for(const r of(a=(s=e.candidates)===null||s===void 0?void 0:s[0].content)===null||a===void 0?void 0:a.parts)r.functionCall&&o.push(r.functionCall);if(o.length>0)return o}const Re=[_.RECITATION,_.SAFETY,_.LANGUAGE];function j(e){return!!e.finishReason&&Re.includes(e.finishReason)}function C(e){var n,t,s;let a="";if((!e.candidates||e.candidates.length===0)&&e.promptFeedback)a+="Response was blocked",!((n=e.promptFeedback)===null||n===void 0)&&n.blockReason&&(a+=` due to ${e.promptFeedback.blockReason}`),!((t=e.promptFeedback)===null||t===void 0)&&t.blockReasonMessage&&(a+=`: ${e.promptFeedback.blockReasonMessage}`);else if(!((s=e.candidates)===null||s===void 0)&&s[0]){const o=e.candidates[0];j(o)&&(a+=`Candidate was blocked due to ${o.finishReason}`,o.finishMessage&&(a+=`: ${o.finishMessage}`))}return a}function S(e){return this instanceof S?(this.v=e,this):new S(e)}function Ae(e,n,t){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var s=t.apply(e,n||[]),a,o=[];return a={},r("next"),r("throw"),r("return"),a[Symbol.asyncIterator]=function(){return this},a;function r(u){s[u]&&(a[u]=function(l){return new Promise(function(g,x){o.push([u,l,g,x])>1||c(u,l)})})}function c(u,l){try{d(s[u](l))}catch(g){p(o[0][3],g)}}function d(u){u.value instanceof S?Promise.resolve(u.value.v).then(f,m):p(o[0][2],u)}function f(u){c("next",u)}function m(u){c("throw",u)}function p(u,l){u(l),o.shift(),o.length&&c(o[0][0],o[0][1])}}const V=/^data\: (.*)(?:\n\n|\r\r|\r\n\r\n)/;function je(e){const n=e.body.pipeThrough(new TextDecoderStream("utf8",{fatal:!0})),t=Le(n),[s,a]=t.tee();return{stream:Me(s),response:Te(a)}}async function Te(e){const n=[],t=e.getReader();for(;;){const{done:s,value:a}=await t.read();if(s)return T(De(n));n.push(a)}}function Me(e){return Ae(this,arguments,function*(){const t=e.getReader();for(;;){const{value:s,done:a}=yield S(t.read());if(a)break;yield yield S(T(s))}})}function Le(e){const n=e.getReader();return new ReadableStream({start(s){let a="";return o();function o(){return n.read().then(({value:r,done:c})=>{if(c){if(a.trim()){s.error(new v("Failed to parse stream"));return}s.close();return}a+=r;let d=a.match(V),f;for(;d;){try{f=JSON.parse(d[1])}catch{s.error(new v(`Error parsing JSON response: "${d[1]}"`));return}s.enqueue(f),a=a.substring(d[0].length),d=a.match(V)}return o()}).catch(r=>{let c=r;throw c.stack=r.stack,c.name==="AbortError"?c=new ne("Request aborted when reading from the stream"):c=new v("Error reading from the stream"),c})}}})}function De(e){const n=e[e.length-1],t={promptFeedback:n?.promptFeedback};for(const s of e){if(s.candidates){let a=0;for(const o of s.candidates)if(t.candidates||(t.candidates=[]),t.candidates[a]||(t.candidates[a]={index:a}),t.candidates[a].citationMetadata=o.citationMetadata,t.candidates[a].groundingMetadata=o.groundingMetadata,t.candidates[a].finishReason=o.finishReason,t.candidates[a].finishMessage=o.finishMessage,t.candidates[a].safetyRatings=o.safetyRatings,o.content&&o.content.parts){t.candidates[a].content||(t.candidates[a].content={role:o.content.role||"user",parts:[]});const r={};for(const c of o.content.parts)c.text&&(r.text=c.text),c.functionCall&&(r.functionCall=c.functionCall),c.executableCode&&(r.executableCode=c.executableCode),c.codeExecutionResult&&(r.codeExecutionResult=c.codeExecutionResult),Object.keys(r).length===0&&(r.text=""),t.candidates[a].content.parts.push(r)}a++}s.usageMetadata&&(t.usageMetadata=s.usageMetadata)}return t}async function se(e,n,t,s){const a=await R(n,N.STREAM_GENERATE_CONTENT,e,!0,JSON.stringify(t),s);return je(a)}async function ae(e,n,t,s){const o=await(await R(n,N.GENERATE_CONTENT,e,!1,JSON.stringify(t),s)).json();return{response:T(o)}}function ie(e){if(e!=null){if(typeof e=="string")return{role:"system",parts:[{text:e}]};if(e.text)return{role:"system",parts:[e]};if(e.parts)return e.role?e:{role:"system",parts:e.parts}}}function O(e){let n=[];if(typeof e=="string")n=[{text:e}];else for(const t of e)typeof t=="string"?n.push({text:t}):n.push(t);return Ge(n)}function Ge(e){const n={role:"user",parts:[]},t={role:"function",parts:[]};let s=!1,a=!1;for(const o of e)"functionResponse"in o?(t.parts.push(o),a=!0):(n.parts.push(o),s=!0);if(s&&a)throw new v("Within a single message, FunctionResponse cannot be mixed with other type of part in the request for sending chat message.");if(!s&&!a)throw new v("No content is provided for sending chat message.");return s?n:t}function $e(e,n){var t;let s={model:n?.model,generationConfig:n?.generationConfig,safetySettings:n?.safetySettings,tools:n?.tools,toolConfig:n?.toolConfig,systemInstruction:n?.systemInstruction,cachedContent:(t=n?.cachedContent)===null||t===void 0?void 0:t.name,contents:[]};const a=e.generateContentRequest!=null;if(e.contents){if(a)throw new w("CountTokensRequest must have one of contents or generateContentRequest, not both.");s.contents=e.contents}else if(a)s=Object.assign(Object.assign({},s),e.generateContentRequest);else{const o=O(e);s.contents=[o]}return{generateContentRequest:s}}function W(e){let n;return e.contents?n=e:n={contents:[O(e)]},e.systemInstruction&&(n.systemInstruction=ie(e.systemInstruction)),n}function Ue(e){return typeof e=="string"||Array.isArray(e)?{content:O(e)}:e}const J=["text","inlineData","functionCall","functionResponse","executableCode","codeExecutionResult"],He={user:["text","inlineData"],function:["functionResponse"],model:["text","functionCall","executableCode","codeExecutionResult"],system:["text"]};function Fe(e){let n=!1;for(const t of e){const{role:s,parts:a}=t;if(!n&&s!=="user")throw new v(`First content should be with role 'user', got ${s}`);if(!$.includes(s))throw new v(`Each item should include role field. Got ${s} but valid roles are: ${JSON.stringify($)}`);if(!Array.isArray(a))throw new v("Content should have 'parts' property with an array of Parts");if(a.length===0)throw new v("Each Content should have at least one part");const o={text:0,inlineData:0,functionCall:0,functionResponse:0,fileData:0,executableCode:0,codeExecutionResult:0};for(const c of a)for(const d of J)d in c&&(o[d]+=1);const r=He[s];for(const c of J)if(!r.includes(c)&&o[c]>0)throw new v(`Content with role '${s}' can't contain '${c}' part`);n=!0}}function z(e){var n;if(e.candidates===void 0||e.candidates.length===0)return!1;const t=(n=e.candidates[0])===null||n===void 0?void 0:n.content;if(t===void 0||t.parts===void 0||t.parts.length===0)return!1;for(const s of t.parts)if(s===void 0||Object.keys(s).length===0||s.text!==void 0&&s.text==="")return!1;return!0}const X="SILENT_ERROR";class Pe{constructor(n,t,s,a={}){this.model=t,this.params=s,this._requestOptions=a,this._history=[],this._sendPromise=Promise.resolve(),this._apiKey=n,s?.history&&(Fe(s.history),this._history=s.history)}async getHistory(){return await this._sendPromise,this._history}async sendMessage(n,t={}){var s,a,o,r,c,d;await this._sendPromise;const f=O(n),m={safetySettings:(s=this.params)===null||s===void 0?void 0:s.safetySettings,generationConfig:(a=this.params)===null||a===void 0?void 0:a.generationConfig,tools:(o=this.params)===null||o===void 0?void 0:o.tools,toolConfig:(r=this.params)===null||r===void 0?void 0:r.toolConfig,systemInstruction:(c=this.params)===null||c===void 0?void 0:c.systemInstruction,cachedContent:(d=this.params)===null||d===void 0?void 0:d.cachedContent,contents:[...this._history,f]},p=Object.assign(Object.assign({},this._requestOptions),t);let u;return this._sendPromise=this._sendPromise.then(()=>ae(this._apiKey,this.model,m,p)).then(l=>{var g;if(z(l.response)){this._history.push(f);const x=Object.assign({parts:[],role:"model"},(g=l.response.candidates)===null||g===void 0?void 0:g[0].content);this._history.push(x)}else{const x=C(l.response);x&&console.warn(`sendMessage() was unsuccessful. ${x}. Inspect response object for details.`)}u=l}).catch(l=>{throw this._sendPromise=Promise.resolve(),l}),await this._sendPromise,u}async sendMessageStream(n,t={}){var s,a,o,r,c,d;await this._sendPromise;const f=O(n),m={safetySettings:(s=this.params)===null||s===void 0?void 0:s.safetySettings,generationConfig:(a=this.params)===null||a===void 0?void 0:a.generationConfig,tools:(o=this.params)===null||o===void 0?void 0:o.tools,toolConfig:(r=this.params)===null||r===void 0?void 0:r.toolConfig,systemInstruction:(c=this.params)===null||c===void 0?void 0:c.systemInstruction,cachedContent:(d=this.params)===null||d===void 0?void 0:d.cachedContent,contents:[...this._history,f]},p=Object.assign(Object.assign({},this._requestOptions),t),u=se(this._apiKey,this.model,m,p);return this._sendPromise=this._sendPromise.then(()=>u).catch(l=>{throw new Error(X)}).then(l=>l.response).then(l=>{if(z(l)){this._history.push(f);const g=Object.assign({},l.candidates[0].content);g.role||(g.role="model"),this._history.push(g)}else{const g=C(l);g&&console.warn(`sendMessageStream() was unsuccessful. ${g}. Inspect response object for details.`)}}).catch(l=>{l.message!==X&&console.error(l)}),u}}async function Be(e,n,t,s){return(await R(n,N.COUNT_TOKENS,e,!1,JSON.stringify(t),s)).json()}async function Ke(e,n,t,s){return(await R(n,N.EMBED_CONTENT,e,!1,JSON.stringify(t),s)).json()}async function Ye(e,n,t,s){const a=t.requests.map(r=>Object.assign(Object.assign({},r),{model:n}));return(await R(n,N.BATCH_EMBED_CONTENTS,e,!1,JSON.stringify({requests:a}),s)).json()}class Q{constructor(n,t,s={}){this.apiKey=n,this._requestOptions=s,t.model.includes("/")?this.model=t.model:this.model=`models/${t.model}`,this.generationConfig=t.generationConfig||{},this.safetySettings=t.safetySettings||[],this.tools=t.tools,this.toolConfig=t.toolConfig,this.systemInstruction=ie(t.systemInstruction),this.cachedContent=t.cachedContent}async generateContent(n,t={}){var s;const a=W(n),o=Object.assign(Object.assign({},this._requestOptions),t);return ae(this.apiKey,this.model,Object.assign({generationConfig:this.generationConfig,safetySettings:this.safetySettings,tools:this.tools,toolConfig:this.toolConfig,systemInstruction:this.systemInstruction,cachedContent:(s=this.cachedContent)===null||s===void 0?void 0:s.name},a),o)}async generateContentStream(n,t={}){var s;const a=W(n),o=Object.assign(Object.assign({},this._requestOptions),t);return se(this.apiKey,this.model,Object.assign({generationConfig:this.generationConfig,safetySettings:this.safetySettings,tools:this.tools,toolConfig:this.toolConfig,systemInstruction:this.systemInstruction,cachedContent:(s=this.cachedContent)===null||s===void 0?void 0:s.name},a),o)}startChat(n){var t;return new Pe(this.apiKey,this.model,Object.assign({generationConfig:this.generationConfig,safetySettings:this.safetySettings,tools:this.tools,toolConfig:this.toolConfig,systemInstruction:this.systemInstruction,cachedContent:(t=this.cachedContent)===null||t===void 0?void 0:t.name},n),this._requestOptions)}async countTokens(n,t={}){const s=$e(n,{model:this.model,generationConfig:this.generationConfig,safetySettings:this.safetySettings,tools:this.tools,toolConfig:this.toolConfig,systemInstruction:this.systemInstruction,cachedContent:this.cachedContent}),a=Object.assign(Object.assign({},this._requestOptions),t);return Be(this.apiKey,this.model,s,a)}async embedContent(n,t={}){const s=Ue(n),a=Object.assign(Object.assign({},this._requestOptions),t);return Ke(this.apiKey,this.model,s,a)}async batchEmbedContents(n,t={}){const s=Object.assign(Object.assign({},this._requestOptions),t);return Ye(this.apiKey,this.model,n,s)}}class qe{constructor(n){this.apiKey=n}getGenerativeModel(n,t){if(!n.model)throw new v("Must provide a model name. Example: genai.getGenerativeModel({ model: 'my-model-name' })");return new Q(this.apiKey,n,t)}getGenerativeModelFromCachedContent(n,t,s){if(!n.name)throw new w("Cached content must contain a `name` field.");if(!n.model)throw new w("Cached content must contain a `model` field.");const a=["model","systemInstruction"];for(const r of a)if(t?.[r]&&n[r]&&t?.[r]!==n[r]){if(r==="model"){const c=t.model.startsWith("models/")?t.model.replace("models/",""):t.model,d=n.model.startsWith("models/")?n.model.replace("models/",""):n.model;if(c===d)continue}throw new w(`Different value for "${r}" specified in modelParams (${t[r]}) and cachedContent (${n[r]})`)}const o=Object.assign(Object.assign({},t),{model:n.model,tools:n.tools,toolConfig:n.toolConfig,systemInstruction:n.systemInstruction,cachedContent:n});return new Q(this.apiKey,o,s)}}const Ve="gemini-3-pro-image-preview",We=[{id:"vintage",name:"Vintage",description:"Adds grain, faded colors, and paper texture.",prompt:"Transform this music album art mosaic into a vintage 1970s print. Add realistic paper texture, slight color fading, and film grain. Maintain the layout but make it look like a physical relic.",textInstructions:"Render the title in a weathered, distressed serif typeface (like Cooper Black or Windsor). The text should look like it was printed with ink that has slightly bled into the paper. Place it at the top or bottom in a classic album title layout."},{id:"polaroid",name:"Polaroid Grid",description:"Makes each cover look like a separate polaroid.",prompt:"Process this image so each album cover appears to be an individual Polaroid photo with white borders, slightly rotated for a messy, organic feel on a dark tabletop.",textInstructions:"Write the title at the bottom of the image in a casual, black permanent marker handwriting style, as if written on the bottom of a photo frame."},{id:"house",name:"House & Electronic",description:"Clean, classic 1990s house vibe with light accents.",prompt:'Apply a clean, to this music album art mosaic with a high-contrast minimalist filter with soft neon glows around the edges. Mimic the center label of a 12" vinyl with a circular mask. Apply a light cyan-to-purple gradient over the entire image at 10% opacity.',textInstructions:'Render the title in a geometric Sans-Serif font (like Inter or Helvetica). Use clean, spaced-out Monospace fonts for secondary details to give a "technical" look.'},{id:"hiphop",name:"Hip-Hop & Rap",description:"Gritty, bold, street-style aesthetic.",prompt:"Convert to high-contrast black and white with heavy grain and a distressed street-poster texture. Add photocopy noise and halftone dots in the shadows.",textInstructions:'Render the title in a bold, heavy-hitting font like Impact or Anton. Use a "hand-style" graffiti font for artist names.'},{id:"jungle",name:"Jungle & DnB",description:"Industrial, cyber, Y2K aesthetic.",prompt:"Add futuristic industrial HUD elements and a CRT monitor scanline effect with green hazmat tints. Overlay transparent digital camouflage patterns and add chromatic aberration.",textInstructions:"Render the title in a wide, tech-focused font like Eurostile or Michroma. Use stencil-style fonts for secondary text."},{id:"acid",name:"Acid Flashback",description:"Early 90s rave psychedelic vibe.",prompt:"Early 90s psychedelic rave flyer aesthetic. Acid house  patterns swirling around the edges. low esolution, blacklight reactive vibe.",textInstructions:'Render the title in "warped" or "liquid" fonts that look like they are melting. Use primitive futuristic fonts for secondary text.'}],Je=[{id:"jungle",name:"Jungle / DnB",description:"Distressed, industrial, Y2K",instruction:'Render the text using distressed, industrial, or "Y2K Cyber" fonts common in Jungle and Drum & Bass culture.'},{id:"hiphop",name:"Hip-Hop",description:"Graffiti tags or bold Impact",instruction:'Render the text using graffiti tags or bold, heavy "Impact" style fonts common in Hip-Hop culture.'},{id:"house",name:"House",description:"Minimalist, Swiss-style",instruction:"Render the text using minimalist, Swiss-style typography common in House music culture."}],ze=[{id:"header",name:"Top Header Strip",description:"Classic 'Stereo' or 'Master' strip at the top",instruction:"Add a distinct, solid-color header strip across the entire top of the image. The strip should look like a classic vinyl 'Stereo' or 'Original Master Recording' banner. Ensure this area has a clear, high-contrast background suitable for text."},{id:"footer",name:"Bottom Footer Strip",description:"Clean band at the bottom for title",instruction:"Add a distinct, solid-color footer strip across the entire bottom of the image. This area should look like a dedicated title space with a clear, high-contrast background suitable for text."},{id:"sticker",name:"Hype Sticker",description:"Sticker on shrink wrap (Top Right)",instruction:"Add a realistic 'hype sticker' to the top-right corner of the image. It should look like it's adhered to the shrink wrap of a vinyl record. The sticker should have a solid background (round or rectangular) providing a clear area for text."}],Xe={enhanceMosaic:async(e,n,t,s,a)=>{const o=ee.getState().apiKeys.gemini||void 0,r=!o||o.startsWith("your_");let c=n.prompt;if(a&&(c+=` ${a.instruction}`),t){const h=s?s.instruction:n.textInstructions;let y="Ensure the text is clearly legible but integrated into the style.";a&&(y=`Place the text "${t}" INSIDE the ${a.name.toLowerCase().includes("sticker")?"hype sticker":"strip"} created above.`),c+=` Add the text "${t}" to the image. ${h} ${y}`}if(r)return console.log("AI Service: Running in MOCK mode with prompt:",c),await new Promise(h=>setTimeout(h,2e3)),e;const f=new qe(o).getGenerativeModel({model:Ve}),m=e.split(",")[1],u=(await f.generateContent([c,{inlineData:{data:m,mimeType:"image/png"}}])).response;if(!u.candidates||u.candidates.length===0)throw new Error("No candidates returned from Gemini");const g=u.candidates[0].content.parts[0];if(!g||!g.inlineData)throw new Error("No image data found in response");const{mimeType:x,data:E}=g.inlineData;return`data:${x};base64,${E}`}},Qe=({onGetImageSource:e,onEnhanced:n})=>{const[t,s]=b.useState(!1),[a,o]=b.useState(null),[r,c]=b.useState(null),[d,f]=b.useState(null),[m,p]=b.useState(""),[u,l]=b.useState(null),{apiKeys:g}=ee(),x=g.gemini&&g.gemini.length>0||void 0,E=async()=>{if(a){s(!0),l(null);try{const h=e(),y=await Xe.enhanceMosaic(h,a,m,r||void 0,d||void 0);n(y)}catch(h){l("AI Enhancement failed. Check your API key or connection."),console.error(h)}finally{s(!1)}}};return i.jsxs("div",{className:"p-6 space-y-6",children:[i.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[i.jsx("div",{className:"bg-purple-500 p-1.5 rounded-lg text-white",children:i.jsx("svg",{width:"16",height:"16",fill:"currentColor",viewBox:"0 0 24 24",children:i.jsx("path",{d:"M12 2L14.5 9.5L22 12L14.5 14.5L12 22L9.5 14.5L2 12L9.5 9.5L12 2Z"})})}),i.jsx("h3",{className:"text-xl font-black",children:"AI Lab"})]}),i.jsxs("div",{className:"space-y-4",children:[i.jsxs("div",{className:"space-y-2",children:[i.jsx("label",{className:"text-[10px] font-black text-gray-400 dark:text-gray-500 uppercase tracking-widest",children:"Mix Tape Title"}),i.jsx("input",{type:"text",value:m,onChange:h=>p(h.target.value),placeholder:"e.g. Sofa Syndicate Vol. 1",className:"w-full p-3 rounded-xl bg-gray-50 dark:bg-gray-800 border border-gray-100 dark:border-gray-700 text-sm focus:outline-none focus:ring-2 focus:ring-purple-500 transition-all"})]}),i.jsxs("div",{className:"space-y-2",children:[i.jsx("label",{className:"text-[10px] font-black text-gray-400 dark:text-gray-500 uppercase tracking-widest",children:"Select Style"}),i.jsx("div",{className:"space-y-2",children:We.map(h=>i.jsxs("button",{onClick:()=>o(h),className:`w-full p-4 rounded-xl border text-left transition-all ${a?.id===h.id?"border-purple-500 bg-purple-50 dark:bg-purple-500/10":"border-gray-100 dark:border-gray-800 hover:border-gray-200 dark:hover:border-gray-700"}`,children:[i.jsx("p",{className:`text-sm font-bold ${a?.id===h.id?"text-purple-600 dark:text-purple-400":""}`,children:h.name}),i.jsx("p",{className:"text-[10px] text-gray-500 dark:text-gray-400 mt-1",children:h.description})]},h.id))})]}),m&&i.jsxs(i.Fragment,{children:[i.jsxs("div",{className:"space-y-2",children:[i.jsx("label",{className:"text-[10px] font-black text-gray-400 dark:text-gray-500 uppercase tracking-widest",children:"Vinyl Label Layout (Optional)"}),i.jsx("div",{className:"space-y-2",children:ze.map(h=>i.jsxs("button",{onClick:()=>f(d?.id===h.id?null:h),className:`w-full p-4 rounded-xl border text-left transition-all ${d?.id===h.id?"border-orange-500 bg-orange-50 dark:bg-orange-500/10":"border-gray-100 dark:border-gray-800 hover:border-gray-200 dark:hover:border-gray-700"}`,children:[i.jsxs("div",{className:"flex items-center justify-between",children:[i.jsx("p",{className:`text-sm font-bold ${d?.id===h.id?"text-orange-600 dark:text-orange-400":""}`,children:h.name}),d?.id===h.id&&i.jsx("span",{className:"text-xs bg-orange-100 dark:bg-orange-900 text-orange-600 dark:text-orange-300 px-2 py-0.5 rounded-full font-bold",children:"SELECTED"})]}),i.jsx("p",{className:"text-[10px] text-gray-500 dark:text-gray-400 mt-1",children:h.description})]},h.id))})]}),i.jsxs("div",{className:"space-y-2",children:[i.jsx("label",{className:"text-[10px] font-black text-gray-400 dark:text-gray-500 uppercase tracking-widest",children:"Font Stylist (Optional)"}),i.jsx("div",{className:"space-y-2",children:Je.map(h=>i.jsxs("button",{onClick:()=>c(r?.id===h.id?null:h),className:`w-full p-4 rounded-xl border text-left transition-all ${r?.id===h.id?"border-blue-500 bg-blue-50 dark:bg-blue-500/10":"border-gray-100 dark:border-gray-800 hover:border-gray-200 dark:hover:border-gray-700"}`,children:[i.jsxs("div",{className:"flex items-center justify-between",children:[i.jsx("p",{className:`text-sm font-bold ${r?.id===h.id?"text-blue-600 dark:text-blue-400":""}`,children:h.name}),r?.id===h.id&&i.jsx("span",{className:"text-xs bg-blue-100 dark:bg-blue-900 text-blue-600 dark:text-blue-300 px-2 py-0.5 rounded-full font-bold",children:"SELECTED"})]}),i.jsx("p",{className:"text-[10px] text-gray-500 dark:text-gray-400 mt-1",children:h.description})]},h.id))})]})]})]}),u&&i.jsx("p",{className:"text-[10px] text-red-500 font-bold bg-red-50 dark:bg-red-500/10 p-2 rounded-lg border border-red-200 dark:border-red-900/50",children:u}),i.jsx("button",{onClick:E,disabled:!a||t||!x,title:x?"":"Gemini API Key required. Configure in Settings.",className:`w-full py-4 font-black rounded-xl transition-all flex items-center justify-center gap-3 shadow-lg active:scale-[0.98] ${!a||t||!x?"bg-gray-100 dark:bg-gray-800 text-gray-400 cursor-not-allowed":"bg-gradient-to-r from-purple-600 to-blue-600 text-white hover:from-purple-700 hover:to-blue-700 shadow-purple-500/20"}`,children:t?i.jsxs(i.Fragment,{children:[i.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-2 border-white/30 border-t-white"}),"PROCESSING..."]}):i.jsxs(i.Fragment,{children:[i.jsx("svg",{width:"18",height:"18",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:i.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M13 10V3L4 14h7v7l9-11h-7z"})}),"ENHANCE & ADD TITLE"]})}),!x&&i.jsx("p",{className:"text-[10px] text-center text-red-500 font-bold",children:"API Key Missing"}),i.jsx("p",{className:"text-[9px] text-center text-gray-400 dark:text-gray-600 uppercase font-black tracking-widest",children:"Powered by Gemini Nano Banana"})]})};var Ze=me();const A=Z(Ze),et=({stageRef:e,albums:n,enhancedImage:t})=>{const[s,a]=b.useState("png"),[o]=b.useState(.9),r=b.useCallback(()=>e.current?e.current.toDataURL({pixelRatio:2}):"",[e]),c=b.useCallback(()=>{if(!e.current&&!t)return;let d="",f=s;t?(d=t,d.startsWith("data:image/png")?f="png":(d.startsWith("data:image/jpeg")||d.startsWith("data:image/jpg"))&&(f="jpeg")):e.current&&(d=e.current.toDataURL({pixelRatio:3,mimeType:`image/${s}`,quality:s==="jpeg"?o:void 0}));let m=d;if(f==="jpeg")try{const u=n.map(y=>`${y.artist} - ${y.album}`).join(", "),l={},g={},x={};l[A.ImageIFD.Software]="WhiteLabel Album Art Creator",g[A.ExifIFD.UserComment]=u;const E={"0th":l,Exif:g,GPS:x},h=A.dump(E);m=A.insert(h,d)}catch(u){console.error("Failed to inject metadata:",u)}const p=document.createElement("a");p.download=`whitelabel-${Date.now()}.${f}`,p.href=m,document.body.appendChild(p),p.click(),document.body.removeChild(p)},[e,s,o,n,t]);return{format:s,setFormat:a,handleExport:c,getCanvasBase64:r}},tt=({bgColor:e,setBgColor:n,columns:t,setColumns:s,gap:a,setGap:o,padding:r,setPadding:c,format:d,setFormat:f,onExport:m,disabled:p})=>{const u=["#0a0a0a","#ffffff","#1f2937","#dc2626","#ea580c","#d97706","#16a34a","#2563eb","#7c3aed","#db2777"];return i.jsxs("div",{className:"p-6",children:[i.jsxs("div",{className:"space-y-6",children:[i.jsxs("div",{className:"space-y-2",children:[i.jsxs("label",{className:"text-[10px] font-black text-gray-400 dark:text-gray-500 uppercase tracking-widest flex justify-between",children:["Background",i.jsx("span",{className:"text-gray-900 dark:text-white uppercase",children:e})]}),i.jsxs("div",{className:"grid grid-cols-5 gap-2",children:[u.map(l=>i.jsx("button",{onClick:()=>n(l),disabled:p,className:`w-full aspect-square rounded-lg border transition-all ${e===l?"border-blue-500 scale-110 shadow-md ring-2 ring-blue-500/20":"border-transparent hover:scale-105"}`,style:{backgroundColor:l}},l)),i.jsxs("div",{className:"relative col-span-5 mt-2",children:[i.jsx("input",{type:"color",value:e,onChange:l=>n(l.target.value),className:"w-full h-8 cursor-pointer rounded-lg overflow-hidden opacity-0 absolute inset-0 z-10",disabled:p}),i.jsx("div",{className:"w-full h-8 rounded-lg border border-gray-200 dark:border-gray-700 flex items-center justify-center text-xs font-bold text-gray-500 hover:bg-gray-50 dark:hover:bg-gray-800 transition-colors",children:"Custom Color Picker"})]})]})]}),i.jsxs("div",{className:"space-y-2",children:[i.jsxs("label",{className:"text-[10px] font-black text-gray-400 dark:text-gray-500 uppercase tracking-widest flex justify-between",children:["Columns",i.jsx("span",{className:"text-gray-900 dark:text-white",children:t})]}),i.jsx("input",{type:"range",min:"1",max:"10",value:t,disabled:p,onChange:l=>s(parseInt(l.target.value)),className:"w-full h-1.5 bg-gray-100 dark:bg-gray-800 rounded-lg appearance-none cursor-pointer accent-blue-500 disabled:opacity-50"})]}),i.jsxs("div",{className:"space-y-2",children:[i.jsxs("label",{className:"text-[10px] font-black text-gray-400 dark:text-gray-500 uppercase tracking-widest flex justify-between",children:["Gap",i.jsxs("span",{className:"text-gray-900 dark:text-white",children:[a,"px"]})]}),i.jsx("input",{type:"range",min:"0",max:"50",value:a,disabled:p,onChange:l=>o(parseInt(l.target.value)),className:"w-full h-1.5 bg-gray-100 dark:bg-gray-800 rounded-lg appearance-none cursor-pointer accent-blue-500 disabled:opacity-50"})]}),i.jsxs("div",{className:"space-y-2",children:[i.jsxs("label",{className:"text-[10px] font-black text-gray-400 dark:text-gray-500 uppercase tracking-widest flex justify-between",children:["Padding",i.jsxs("span",{className:"text-gray-900 dark:text-white",children:[r,"px"]})]}),i.jsx("input",{type:"range",min:"0",max:"100",value:r,disabled:p,onChange:l=>c(parseInt(l.target.value)),className:"w-full h-1.5 bg-gray-100 dark:bg-gray-800 rounded-lg appearance-none cursor-pointer accent-blue-500 disabled:opacity-50"})]})]}),i.jsxs("div",{className:"space-y-4 pt-6 mt-6 border-t border-gray-100 dark:border-gray-800",children:[i.jsx("h4",{className:"text-[10px] font-black text-gray-400 dark:text-gray-500 uppercase tracking-widest",children:"Export Settings"}),i.jsxs("div",{className:"flex bg-gray-100 dark:bg-gray-800 p-1 rounded-xl",children:[i.jsx("button",{onClick:()=>f("png"),className:`flex-1 py-2 text-xs font-black rounded-lg transition-all ${d==="png"?"bg-white dark:bg-gray-700 text-gray-900 dark:text-white shadow-sm":"text-gray-400 hover:text-gray-600 dark:hover:text-gray-300"}`,children:"PNG"}),i.jsx("button",{onClick:()=>f("jpeg"),className:`flex-1 py-2 text-xs font-black rounded-lg transition-all ${d==="jpeg"?"bg-white dark:bg-gray-700 text-gray-900 dark:text-white shadow-sm":"text-gray-400 hover:text-gray-600 dark:hover:text-gray-300"}`,children:"JPEG"})]}),i.jsxs("button",{onClick:m,className:"w-full py-4 bg-gray-900 dark:bg-white text-white dark:text-black font-black rounded-xl hover:bg-black dark:hover:bg-gray-100 transition-all flex items-center justify-center gap-3 shadow-lg active:scale-[0.98] mt-4",children:[i.jsx("svg",{width:"20",height:"20",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:i.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"})}),"DOWNLOAD"]})]})]})};var nt=ue();const st=Z(nt),at=({album:e,x:n,y:t,size:s})=>{const[a]=st(e.localUrl||e.url,"anonymous");return i.jsx(pe,{image:a,x:n,y:t,width:s,height:s,cornerRadius:2})},it=({stageRef:e,albums:n,columns:t,gap:s,padding:a,bgColor:o,stageSize:r,isHidden:c})=>{const d=Math.ceil(n.length/t),f=r,p=(f-a*2-s*(t-1))/t,u=d*p+s*(d-1)+a*2;return i.jsx(he,{width:f,height:u,ref:e,className:`rounded-lg overflow-hidden shadow-inner ${c?"hidden":"block"}`,children:i.jsxs(ge,{children:[i.jsx(fe,{x:0,y:0,width:f,height:u,fill:o}),n.map((l,g)=>{const x=g%t,E=Math.floor(g/t),h=a+x*(p+s),y=a+E*(p+s);return i.jsx(at,{album:l,x:h,y,size:p},l.id)})]})})},dt=({albums:e,columns:n=3,gap:t=2,padding:s=6,backgroundColor:a="#0a0a0a"})=>{const o=b.useRef(null),[r,c]=b.useState(800),[d,f]=b.useState(n),[m,p]=b.useState(t),[u,l]=b.useState(s),[g,x]=b.useState(a),[E,h]=b.useState("settings"),[y,M]=b.useState(null),{format:oe,setFormat:re,handleExport:ce,getCanvasBase64:le}=et({stageRef:o,albums:e,enhancedImage:y});return b.useEffect(()=>{const I=()=>{const de=Math.min(window.innerWidth-40,800);c(de)};return window.addEventListener("resize",I),I(),()=>window.removeEventListener("resize",I)},[]),i.jsxs("div",{className:"flex flex-col lg:flex-row gap-8 w-full max-w-7xl items-start",children:[i.jsxs("div",{className:"flex-1 flex flex-col items-center gap-6 w-full",children:[i.jsxs("div",{className:"bg-white dark:bg-gray-900 p-4 rounded-2xl shadow-xl border border-gray-100 dark:border-gray-800 w-full overflow-hidden flex justify-center relative",children:[i.jsx(it,{stageRef:o,albums:e,columns:d,gap:m,padding:u,bgColor:g,stageSize:r,isHidden:!!y}),y&&i.jsxs("div",{className:"relative group animate-in zoom-in-95 duration-500",children:[i.jsx("img",{src:y,alt:"AI Enhanced",className:"rounded-lg shadow-2xl max-w-full"}),i.jsx("button",{onClick:()=>M(null),className:"absolute top-4 right-4 bg-black/50 hover:bg-black text-white px-3 py-1 rounded-full text-xs font-bold backdrop-blur-md transition-all opacity-0 group-hover:opacity-100",children:"Reset AI"})]})]}),y&&i.jsxs("div",{className:"bg-purple-500/10 border border-purple-500/20 text-purple-600 dark:text-purple-400 p-4 rounded-xl text-center w-full",children:[i.jsx("p",{className:"text-sm font-bold",children:"âœ¨ AI Enhancement Applied"}),i.jsx("p",{className:"text-xs",children:"Your image has been reimagined by Nano Banana. You can still adjust export settings below."})]})]}),i.jsx("div",{className:"w-full lg:w-80 flex flex-col gap-6",children:i.jsxs("div",{className:"bg-white dark:bg-gray-900 rounded-2xl border border-gray-100 dark:border-gray-800 shadow-sm overflow-hidden",children:[i.jsxs("div",{className:"flex border-b border-gray-100 dark:border-gray-800",children:[i.jsx("button",{onClick:()=>h("settings"),className:`flex-1 py-4 text-xs font-black tracking-widest uppercase transition-colors ${E==="settings"?"bg-gray-50 dark:bg-gray-800/50 text-blue-600 dark:text-blue-400 border-b-2 border-blue-500":"text-gray-400 hover:text-gray-600 dark:hover:text-gray-300 hover:bg-gray-50 dark:hover:bg-gray-800/50"}`,children:"Canvas Settings"}),i.jsx("button",{onClick:()=>h("ai"),className:`flex-1 py-4 text-xs font-black tracking-widest uppercase transition-colors ${E==="ai"?"bg-purple-50 dark:bg-purple-900/10 text-purple-600 dark:text-purple-400 border-b-2 border-purple-500":"text-gray-400 hover:text-gray-600 dark:hover:text-gray-300 hover:bg-gray-50 dark:hover:bg-gray-800/50"}`,children:"AI Lab"})]}),E==="settings"?i.jsx(tt,{bgColor:g,setBgColor:x,columns:d,setColumns:f,gap:m,setGap:p,padding:u,setPadding:l,format:oe,setFormat:re,onExport:ce,disabled:!!y}):i.jsx(Qe,{onGetImageSource:le,onEnhanced:I=>M(I)})]})})]})};export{dt as MosaicCanvas};
